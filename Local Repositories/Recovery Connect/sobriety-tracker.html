<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Sobriety Tracker - Recovery Connect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Figtree:wght@300;400;500;600;700;800;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-teal: #06b6d4;
            --primary-coral: #f97316;
            --primary-amber: #f59e0b;
            --secondary-purple: #8b5cf6;
            --secondary-pink: #ec4899;
            --accent-lime: #84cc16;
            --neutral-dark: #0f172a;
            --neutral-medium: #334155;
            --neutral-light: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-brutal: 8px 8px 0px #0f172a;
            --shadow-soft: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            cursor: none;
        }

        body {
            font-family: 'Figtree', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            overflow-x: hidden;
            background: var(--neutral-light);
            cursor: none;
        }

        /* Custom Cursor */
        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: var(--primary-teal);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            mix-blend-mode: difference;
        }

        .cursor-follower {
            position: fixed;
            width: 40px;
            height: 40px;
            background: transparent;
            border: 2px solid var(--primary-coral);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            transition: transform 0.3s ease;
        }

        /* Progress Bar */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-teal), var(--primary-coral), var(--primary-amber));
            z-index: 1001;
            transition: width 0.3s ease;
        }

        /* Loading Screen with 3D Effects */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--neutral-dark) 0%, var(--neutral-medium) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease;
        }

        .loader-content {
            text-align: center;
            color: white;
            transform-style: preserve-3d;
        }

        .loader-cube {
            width: 60px;
            height: 60px;
            margin: 0 auto 30px;
            position: relative;
            transform-style: preserve-3d;
            animation: cube-rotate 2s infinite ease-in-out;
        }

        .cube-face {
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--primary-teal);
            border: 2px solid var(--primary-coral);
        }

        .cube-face.front { transform: rotateY(0deg) translateZ(30px); }
        .cube-face.back { transform: rotateY(180deg) translateZ(30px); }
        .cube-face.right { transform: rotateY(90deg) translateZ(30px); }
        .cube-face.left { transform: rotateY(-90deg) translateZ(30px); }
        .cube-face.top { transform: rotateX(90deg) translateZ(30px); }
        .cube-face.bottom { transform: rotateX(-90deg) translateZ(30px); }

        @keyframes cube-rotate {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        .loader-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px var(--primary-teal); }
            to { text-shadow: 0 0 20px var(--primary-coral), 0 0 30px var(--primary-amber); }
        }

        /* Header with Brutal Design */
        header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            border-radius: 0;
            padding: 1rem 2rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 3rem;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neutral-dark);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .nav-links a:hover {
            background: var(--primary-teal);
            color: white;
            border-color: var(--neutral-dark);
            transform: translateY(-2px);
        }

        /* Main Container */
        .tracker-container {
            max-width: 1200px;
            margin: 120px auto 4rem;
            padding: 2rem;
            background: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
        }

        .tracker-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--neutral-light);
        }

        .tracker-icon {
            width: 70px;
            height: 70px;
            background: var(--primary-coral);
            border: 3px solid var(--neutral-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 4px 4px 0px var(--neutral-dark);
        }

        .tracker-title {
            flex: 1;
        }

        .tracker-title h1 {
            font-family: 'Figtree', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--neutral-dark);
        }

        .tracker-title p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .tracker-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .tracker-grid {
                grid-template-columns: 1fr;
            }
        }

        .tracker-card {
            padding: 2rem;
            background: white;
            border: 3px solid var(--neutral-dark);
            box-shadow: 4px 4px 0px var(--neutral-dark);
            margin-bottom: 2rem;
        }

        .tracker-card h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tracker-card h2 i {
            background: var(--primary-teal);
            color: white;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--neutral-dark);
        }

        .sobriety-count {
            font-size: 4rem;
            text-align: center;
            font-weight: 800;
            margin: 2rem 0;
            color: var(--primary-teal);
            font-family: 'JetBrains Mono', monospace;
        }

        .count-label {
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            font-weight: 700;
            font-size: 1rem;
            border: 3px solid var(--neutral-dark);
            box-shadow: 4px 4px 0px var(--neutral-dark);
            transition: all 0.3s ease;
            text-transform: uppercase;
            text-decoration: none;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--primary-teal);
            color: white;
        }

        .btn-secondary {
            background: white;
            color: var(--neutral-dark);
        }

        .btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px var(--neutral-dark);
        }

        .track-actions {
            text-align: center;
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin: 1rem 0 2rem;
        }

        .day-label {
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            font-size: 0.9rem;
            padding: 0.5rem;
            border-bottom: 1px solid var(--neutral-light);
        }

        .calendar-day {
            aspect-ratio: 1/1;
            border: 2px solid var(--neutral-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            border-color: var(--primary-teal);
            transform: scale(1.05);
        }

        .calendar-day.sober {
            background: var(--primary-teal);
            color: white;
            border-color: var(--neutral-dark);
        }

        .calendar-day.today {
            border-color: var(--neutral-dark);
            font-weight: 700;
        }

        .calendar-day.milestone {
            background: var(--primary-coral);
            color: white;
            border-color: var(--neutral-dark);
            position: relative;
        }

        .calendar-day.milestone::after {
            content: '🎉';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 12px;
        }

        .milestone-list {
            list-style: none;
            margin: 1rem 0;
        }

        .milestone-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid var(--neutral-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .milestone-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-coral);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid var(--neutral-dark);
        }

        .milestone-content {
            flex: 1;
        }

        .milestone-content h4 {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .milestone-content p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .milestone-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--neutral-dark);
            font-family: 'Figtree', sans-serif;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-teal);
        }

        /* Feature highlights */
        .feature-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature-item {
            background: var(--neutral-light);
            padding: 0.5rem 1rem;
            border: 2px solid var(--neutral-dark);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-item i {
            color: var(--primary-teal);
        }

        /* Chart container */
        .chart-container {
            margin-top: 2rem;
            height: 300px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Milestone Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral-dark);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .modal-header p {
            color: var(--text-secondary);
        }

        /* Add this to make the cursor inherit for mobile */
        @media (max-width: 768px) {
            html, body {
                cursor: inherit;
            }
            
            .custom-cursor, .cursor-follower {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor -->
    <div class="custom-cursor"></div>
    <div class="cursor-follower"></div>

    <!-- Scroll Progress -->
    <div class="scroll-progress"></div>

    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="loader-content">
            <div class="loader-cube">
                <div class="cube-face front"></div>
                <div class="cube-face back"></div>
                <div class="cube-face right"></div>
                <div class="cube-face left"></div>
                <div class="cube-face top"></div>
                <div class="cube-face bottom"></div>
            </div>
            <div class="loader-text">SOBRIETY_TRACKER</div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <nav>
            <div class="logo">R_CONNECT</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="resource-library.html">Resources</a></li>
                <li><a href="recovery-tools.html">Tools</a></li>
                <li><a href="crisis-support.html">Crisis</a></li>
                <li><a href="peer-mentorship.html">Mentors</a></li>
                <li><a href="index.html#chat">Community</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="tracker-container">
        <div class="tracker-header">
            <div class="tracker-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="tracker-title">
                <h1>Daily Sobriety Tracker</h1>
                <p>Track your sobriety progress day by day with this interactive tool that helps you visualize your journey and celebrate milestones.</p>
            </div>
        </div>

        <div class="feature-list">
            <div class="feature-item"><i class="fas fa-check-circle"></i> Day counter</div>
            <div class="feature-item"><i class="fas fa-award"></i> Milestone celebrations</div>
            <div class="feature-item"><i class="fas fa-chart-line"></i> Pattern recognition</div>
            <div class="feature-item"><i class="fas fa-file-export"></i> Export data</div>
        </div>

        <div class="tracker-grid">
            <!-- Day Counter Section -->
            <div class="tracker-card">
                <h2><i class="fas fa-calendar-day"></i> Day Counter</h2>
                <div class="sobriety-count" id="sobrietyCount">0</div>
                <div class="count-label">Days Sober</div>
                <div class="track-actions">
                    <button class="btn btn-primary" id="checkInBtn">CHECK IN TODAY</button>
                    <button class="btn btn-secondary" id="resetBtn">SET START DATE</button>
                </div>
            </div>

            <!-- Calendar Section -->
            <div class="tracker-card">
                <h2><i class="fas fa-calendar"></i> Sobriety Calendar</h2>
                <div id="month-year" style="text-align: center; font-weight: 600; margin-bottom: 1rem;">June 2025</div>
                <div class="calendar-navigation" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                    <button class="btn btn-secondary" id="prevMonth" style="padding: 0.5rem 1rem; font-size: 0.9rem;">← PREV</button>
                    <button class="btn btn-secondary" id="nextMonth" style="padding: 0.5rem 1rem; font-size: 0.9rem;">NEXT →</button>
                </div>
                <div class="calendar-grid" id="calendar-days-labels">
                    <div class="day-label">SUN</div>
                    <div class="day-label">MON</div>
                    <div class="day-label">TUE</div>
                    <div class="day-label">WED</div>
                    <div class="day-label">THU</div>
                    <div class="day-label">FRI</div>
                    <div class="day-label">SAT</div>
                </div>
                <div class="calendar-grid" id="calendar-days">
                    <!-- Calendar days will be generated here -->
                </div>
            </div>

            <!-- Progress Chart -->
            <div class="tracker-card">
                <h2><i class="fas fa-chart-line"></i> Progress Visualization</h2>
                <div class="chart-container">
                    <canvas id="sobrietyChart"></canvas>
                </div>
            </div>

            <!-- Milestones Section -->
            <div class="tracker-card">
                <h2><i class="fas fa-trophy"></i> Milestones</h2>
                <div id="milestone-list" class="milestone-list">
                    <!-- Milestones will be displayed here -->
                </div>
                <div class="track-actions">
                    <button class="btn btn-primary" id="customMilestoneBtn">ADD MILESTONE</button>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="tracker-card">
            <h2><i class="fas fa-sticky-note"></i> Recovery Journal</h2>
            <div class="form-group">
                <label for="journalDate">Date</label>
                <input type="date" id="journalDate" value="">
            </div>
            <div class="form-group">
                <label for="journalEntry">Journal Entry</label>
                <textarea id="journalEntry" rows="5" placeholder="Write about your recovery journey, feelings, challenges, or victories today..."></textarea>
            </div>
            <div class="form-group">
                <label for="moodRating">Mood Rating (1-10)</label>
                <input type="range" id="moodRating" min="1" max="10" value="5">
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                    <span style="font-size: 0.8rem;">Struggling</span>
                    <span style="font-size: 0.8rem;">Good</span>
                    <span style="font-size: 0.8rem;">Great</span>
                </div>
            </div>
            <div class="track-actions">
                <button class="btn btn-primary" id="saveJournalBtn">SAVE ENTRY</button>
                <button class="btn btn-secondary" id="viewEntriesBtn">VIEW PAST ENTRIES</button>
            </div>
        </div>

        <!-- Export Section -->
        <div class="tracker-card">
            <h2><i class="fas fa-download"></i> Export Your Data</h2>
            <p style="margin-bottom: 1.5rem;">Download your sobriety tracking data for personal records or to share with your support network.</p>
            <div class="track-actions">
                <button class="btn btn-primary" id="exportBtn">EXPORT DATA</button>
                <button class="btn btn-secondary" id="printBtn">PRINT VIEW</button>
            </div>
        </div>
    </main>

    <!-- Milestone Modal -->
    <div class="modal" id="milestoneModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <div class="modal-header">
                <h2>Add Custom Milestone</h2>
                <p>Celebrate special moments in your recovery journey</p>
            </div>
            <div class="form-group">
                <label for="milestoneTitle">Milestone Title</label>
                <input type="text" id="milestoneTitle" placeholder="e.g., 30 Days Sober, Completed Therapy Program">
            </div>
            <div class="form-group">
                <label for="milestoneDate">Date Achieved</label>
                <input type="date" id="milestoneDate">
            </div>
            <div class="form-group">
                <label for="milestoneDescription">Description (Optional)</label>
                <textarea id="milestoneDescription" rows="3" placeholder="Describe this milestone and why it's significant to you..."></textarea>
            </div>
            <div class="track-actions">
                <button class="btn btn-primary" id="saveMilestoneBtn">SAVE MILESTONE</button>
            </div>
        </div>
    </div>

    <!-- Start Date Modal -->
    <div class="modal" id="startDateModal">
        <div class="modal-content">
            <button class="close-modal" id="closeStartDateModal">&times;</button>
            <div class="modal-header">
                <h2>Set Your Sobriety Start Date</h2>
                <p>This will reset your counter to this date</p>
            </div>
            <div class="form-group">
                <label for="sobrietyStartDate">Sobriety Start Date</label>
                <input type="date" id="sobrietyStartDate">
            </div>
            <div class="track-actions">
                <button class="btn btn-primary" id="saveStartDateBtn">SET START DATE</button>
            </div>
        </div>
    </div>

    <!-- Journal Entries Modal -->
    <div class="modal" id="entriesModal">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <button class="close-modal" id="closeEntriesModal">&times;</button>
            <div class="modal-header">
                <h2>Your Journal Entries</h2>
                <p>Review your recovery journey</p>
            </div>
            <div id="entriesList" style="margin-top: 1.5rem;">
                <!-- Journal entries will be listed here -->
            </div>
        </div>
    </div>

    <footer>
        <p>RECOVERY CONNECT &copy; 2025 - DAILY SOBRIETY TRACKER</p>
        <p style="margin-top: 0.5rem; font-size: 0.8rem;">Your data is stored locally on your device for privacy</p>
    </footer>

    <script>
        // Custom Cursor
        const cursor = document.querySelector('.custom-cursor');
        const follower = document.querySelector('.cursor-follower');

        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
            
            setTimeout(() => {
                follower.style.left = e.clientX + 'px';
                follower.style.top = e.clientY + 'px';
            }, 100);
        });

        // Loading Screen
        window.addEventListener('load', function() {
            const loader = document.getElementById('loader');
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 800);
            }, 1000);
        });

        // Scroll Progress
        window.addEventListener('scroll', () => {
            const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            document.querySelector('.scroll-progress').style.width = scrolled + '%';
        });

        // Initialize date inputs to today
        const today = new Date();
        const todayFormatted = today.toISOString().split('T')[0];
        document.getElementById('journalDate').value = todayFormatted;
        document.getElementById('milestoneDate').value = todayFormatted;
        document.getElementById('sobrietyStartDate').value = todayFormatted;

        // Check if sobriety data exists in localStorage
        let sobrietyData = JSON.parse(localStorage.getItem('sobrietyData')) || {
            startDate: todayFormatted,
            soberDays: [],
            milestones: [],
            journalEntries: []
        };

        // Calculate days sober
        function calculateDaysSober() {
            const startDate = new Date(sobrietyData.startDate);
            const currentDate = new Date();
            const diffTime = Math.abs(currentDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update sobriety counter
        function updateSobrietyCounter() {
            const daysSober = calculateDaysSober();
            document.getElementById('sobrietyCount').textContent = daysSober;
        }

        // Initialize calendar
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();

        function generateCalendar(month, year) {
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            document.getElementById('month-year').textContent = `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;
            
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('calendar-day');
                emptyDay.style.visibility = 'hidden';
                calendarDays.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('calendar-day');
                dayElement.textContent = i;
                
                // Check if this day is today
                const currentDate = new Date();
                if (i === currentDate.getDate() && month === currentDate.getMonth() && year === currentDate.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Check if this day is in soberDays
                const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                if (sobrietyData.soberDays.includes(dateString)) {
                    dayElement.classList.add('sober');
                }
                
                // Check if this day is a milestone
                const isMilestone = sobrietyData.milestones.some(milestone => milestone.date === dateString);
                if (isMilestone) {
                    dayElement.classList.add('milestone');
                }
                
                // Add click event to toggle sober status
                dayElement.addEventListener('click', () => {
                    const clickedDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                    
                    // Toggle sober status for this day
                    const index = sobrietyData.soberDays.indexOf(clickedDate);
                    if (index === -1) {
                        sobrietyData.soberDays.push(clickedDate);
                        dayElement.classList.add('sober');
                    } else {
                        sobrietyData.soberDays.splice(index, 1);
                        dayElement.classList.remove('sober');
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                    
                    // Update chart
                    updateChart();
                });
                
                calendarDays.appendChild(dayElement);
            }
        }

        // Initialize chart
        let sobrietyChart;

        function initializeChart() {
            const ctx = document.getElementById('sobrietyChart').getContext('2d');
            
            // Calculate streak data for the last 30 days
            const dates = [];
            const streaks = [];
            
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 29); // Last 30 days
            
            let currentDate = new Date(startDate);
            let currentStreak = 0;
            
            while (currentDate <= endDate) {
                const dateString = currentDate.toISOString().split('T')[0];
                dates.push(dateString);
                
                if (sobrietyData.soberDays.includes(dateString)) {
                    currentStreak++;
                } else {
                    currentStreak = 0;
                }
                
                streaks.push(currentStreak);
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            sobrietyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Sobriety Streak',
                        data: streaks,
                        backgroundColor: 'rgba(6, 182, 212, 0.2)',
                        borderColor: 'rgba(6, 182, 212, 1)',
                        borderWidth: 3,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Consecutive Sober Days'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (sobrietyChart) {
                sobrietyChart.destroy();
            }
            initializeChart();
        }

        // Display milestones
        function displayMilestones() {
            const milestoneList = document.getElementById('milestone-list');
            milestoneList.innerHTML = '';
            
            if (sobrietyData.milestones.length === 0) {
                milestoneList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No milestones added yet.</p>';
                return;
            }
            
            // Sort milestones by date, newest first
            const sortedMilestones = [...sobrietyData.milestones].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedMilestones.forEach(milestone => {
                const milestoneItem = document.createElement('div');
                milestoneItem.classList.add('milestone-item');
                
                milestoneItem.innerHTML = `
                    <div class="milestone-icon">🏆</div>
                    <div class="milestone-content">
                        <h4>${milestone.title}</h4>
                        ${milestone.description ? `<p>${milestone.description}</p>` : ''}
                        <span class="milestone-date">${new Date(milestone.date).toLocaleDateString()}</span>
                    </div>
                `;
                
                milestoneList.appendChild(milestoneItem);
            });
        }

        // Check in for today
        document.getElementById('checkInBtn').addEventListener('click', function() {
            const todayFormatted = new Date().toISOString().split('T')[0];
            
            if (!sobrietyData.soberDays.includes(todayFormatted)) {
                sobrietyData.soberDays.push(todayFormatted);
                localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                
                // Update calendar and chart
                generateCalendar(currentMonth, currentYear);
                updateChart();
                
                alert('Great job! You've checked in as sober today.');
            } else {
                alert('You've already checked in as sober today!');
            }
        });

        // Reset button / Set start date
        document.getElementById('resetBtn').addEventListener('click', function() {
            document.getElementById('startDateModal').style.display = 'flex';
        });

        // Save start date
        document.getElementById('saveStartDateBtn').addEventListener('click', function() {
            const newStartDate = document.getElementById('sobrietyStartDate').value;
            
            if (newStartDate) {
                sobrietyData.startDate = newStartDate;
                localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                
                updateSobrietyCounter();
                document.getElementById('startDateModal').style.display = 'none';
                
                alert('Your sobriety start date has been updated.');
            } else {
                alert('Please select a valid date.');
            }
        });

        // Calendar navigation
        document.getElementById('prevMonth').addEventListener('click', function() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentMonth, currentYear);
        });

        document.getElementById('nextMonth').addEventListener('click', function() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear);
        });

        // Custom milestone button
        document.getElementById('customMilestoneBtn').addEventListener('click', function() {
            document.getElementById('milestoneModal').style.display = 'flex';
        });

        // Save milestone
        document.getElementById('saveMilestoneBtn').addEventListener('click', function() {
            const title = document.getElementById('milestoneTitle').value;
            const date = document.getElementById('milestoneDate').value;
            const description = document.getElementById('milestoneDescription').value;
            
            if (title && date) {
                const newMilestone = {
                    id: Date.now(),
                    title,
                    date,
                    description
                };
                
                sobrietyData.milestones.push(newMilestone);
                localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                
                // Update milestones and calendar
                displayMilestones();
                generateCalendar(currentMonth, currentYear);
                
                document.getElementById('milestoneTitle').value = '';
                document.getElementById('milestoneDescription').value = '';
                document.getElementById('milestoneModal').style.display = 'none';
                
                alert('Milestone added successfully!');
            } else {
                alert('Please enter a title and date for your milestone.');
            }
        });

        // Save journal entry
        document.getElementById('saveJournalBtn').addEventListener('click', function() {
            const date = document.getElementById('journalDate').value;
            const entry = document.getElementById('journalEntry').value;
            const moodRating = document.getElementById('moodRating').value;
            
            if (date && entry) {
                const journalEntry = {
                    id: Date.now(),
                    date,
                    entry,
                    moodRating
                };
                
                sobrietyData.journalEntries.push(journalEntry);
                localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                
                document.getElementById('journalEntry').value = '';
                document.getElementById('moodRating').value = '5';
                
                alert('Journal entry saved successfully!');
            } else {
                alert('Please enter both date and journal entry.');
            }
        });

        // View journal entries
        document.getElementById('viewEntriesBtn').addEventListener('click', function() {
            const entriesList = document.getElementById('entriesList');
            entriesList.innerHTML = '';
            
            if (sobrietyData.journalEntries.length === 0) {
                entriesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No journal entries yet.</p>';
            } else {
                // Sort entries by date, newest first
                const sortedEntries = [...sobrietyData.journalEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedEntries.forEach(entry => {
                    const entryItem = document.createElement('div');
                    entryItem.style.marginBottom = '2rem';
                    entryItem.style.padding = '1.5rem';
                    entryItem.style.border = '2px solid var(--neutral-light)';
                    
                    entryItem.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <h3 style="font-weight: 700;">${new Date(entry.date).toLocaleDateString()}</h3>
                            <div>Mood: ${entry.moodRating}/10</div>
                        </div>
                        <p style="white-space: pre-wrap;">${entry.entry}</p>
                        <button class="btn btn-secondary delete-entry" data-id="${entry.id}" style="margin-top: 1rem; padding: 0.5rem 1rem; font-size: 0.9rem;">DELETE</button>
                    `;
                    
                    entriesList.appendChild(entryItem);
                });
                
                // Add delete functionality
                document.querySelectorAll('.delete-entry').forEach(button => {
                    button.addEventListener('click', function() {
                        const entryId = parseInt(this.getAttribute('data-id'));
                        
                        if (confirm('Are you sure you want to delete this entry?')) {
                            sobrietyData.journalEntries = sobrietyData.journalEntries.filter(entry => entry.id !== entryId);
                            localStorage.setItem('sobrietyData', JSON.stringify(sobrietyData));
                            
                            // Refresh the entries list
                            this.closest('div').remove();
                            
                            if (sobrietyData.journalEntries.length === 0) {
                                entriesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No journal entries yet.</p>';
                            }
                        }
                    });
                });
            }
            
            document.getElementById('entriesModal').style.display = 'flex';
        });

        // Export data
        document.getElementById('exportBtn').addEventListener('click', function() {
            const dataStr = JSON.stringify(sobrietyData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileName = `sobriety-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileName);
            document.body.appendChild(linkElement);
            linkElement.click();
            document.body.removeChild(linkElement);
        });

        // Print view
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });

        // Close modals
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('milestoneModal').style.display = 'none';
        });

        document.getElementById('closeStartDateModal').addEventListener('click', function() {
            document.getElementById('startDateModal').style.display = 'none';
        });

        document.getElementById('closeEntriesModal').addEventListener('click', function() {
            document.getElementById('entriesModal').style.display = 'none';
        });

        // When clicking outside of modal content, close the modal
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('milestoneModal')) {
                document.getElementById('milestoneModal').style.display = 'none';
            }
            if (event.target === document.getElementById('startDateModal')) {
                document.getElementById('startDateModal').style.display = 'none';
            }
            if (event.target === document.getElementById('entriesModal')) {
                document.getElementById('entriesModal').style.display = 'none';
            }
        });

        // Initialize everything
        updateSobrietyCounter();
        generateCalendar(currentMonth, currentYear);
        initializeChart();
        displayMilestones();

        // Enhanced effects for buttons
        document.addEventListener('mouseover', function(e) {
            if (e.target.classList.contains('btn') || e.target.classList.contains('calendar-day')) {
                cursor.style.transform = 'scale(1.5)';
                follower.style.transform = 'scale(1.2)';
            }
        });
        
        document.addEventListener('mouseout', function(e) {
            if (e.target.classList.contains('btn') || e.target.classList.contains('calendar-day')) {
                cursor.style.transform = 'scale(1)';
                follower.style.transform = 'scale(1)';
            }
        });
    </script>
</body>
</html>