<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBT Tools - Recovery Connect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Figtree:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-teal: #06b6d4;
            --primary-coral: #f97316;
            --primary-amber: #f59e0b;
            --secondary-purple: #8b5cf6;
            --secondary-pink: #ec4899;
            --accent-lime: #84cc16;
            --neutral-dark: #0f172a;
            --neutral-medium: #334155;
            --neutral-light: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #ffffff;
            --shadow-brutal: 8px 8px 0px #0f172a;
            --success-green: #22c55e;
            --warning-yellow: #eab308;
            --danger-red: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Figtree', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--neutral-light);
            padding: 2rem;
        }

        .cbt-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            background: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 3rem;
        }

        .header h1 {
            font-family: 'Figtree', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--neutral-dark);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .evidence-banner {
            background: linear-gradient(135deg, var(--success-green), var(--primary-teal));
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 3rem;
            text-align: center;
        }

        .evidence-banner h3 {
            font-weight: 900;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .evidence-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1rem;
            text-align: center;
        }

        .stat-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 900;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .tool-selector {
            background: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 3rem;
            margin-bottom: 3rem;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .tool-card {
            background: var(--neutral-light);
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .tool-card:hover {
            background: var(--primary-teal);
            color: white;
            transform: translate(-4px, -4px);
            box-shadow: 8px 8px 0px var(--neutral-dark);
        }

        .tool-card.active {
            background: var(--primary-coral);
            color: white;
            transform: translate(-4px, -4px);
            box-shadow: 8px 8px 0px var(--neutral-dark);
        }

        .evidence-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--success-green);
            color: white;
            border: 2px solid var(--neutral-dark);
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            transform: rotate(15deg);
        }

        .tool-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .tool-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .tool-description {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .tool-effectiveness {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid var(--success-green);
            color: var(--success-green);
            padding: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .cbt-tool {
            background: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 3rem;
            margin-bottom: 3rem;
            display: none;
        }

        .cbt-tool.active {
            display: block;
        }

        .tool-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .tool-header h2 {
            font-size: 2rem;
            font-weight: 900;
            color: var(--neutral-dark);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .tool-intro {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.7;
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .psychoeducation-section {
            background: linear-gradient(135deg, var(--secondary-purple), var(--secondary-pink));
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .psychoeducation-section h3 {
            font-weight: 900;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .learning-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .learning-point {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1.5rem;
        }

        .exercise-section {
            background: var(--neutral-light);
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-title {
            font-weight: 700;
            color: var(--primary-teal);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .crisis-warning {
            background: var(--danger-red);
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .crisis-warning h4 {
            font-size: 1.2rem;
            font-weight: 900;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .crisis-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .crisis-btn {
            background: white;
            color: var(--danger-red);
            border: 3px solid var(--neutral-dark);
            padding: 1rem 2rem;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .crisis-btn:hover {
            background: var(--neutral-dark);
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px white;
        }

        .thought-record-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .thought-column {
            background: white;
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
        }

        .column-header {
            font-weight: 700;
            color: var(--neutral-dark);
            margin-bottom: 1rem;
            text-transform: uppercase;
            text-align: center;
            background: var(--primary-teal);
            color: white;
            padding: 0.5rem;
            margin: -2rem -2rem 1rem -2rem;
        }

        .thought-input {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 3px solid var(--neutral-dark);
            font-family: 'Figtree', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            background: white;
            margin-bottom: 1rem;
        }

        .thought-input:focus {
            outline: none;
            border-color: var(--primary-teal);
        }

        .mood-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            background: white;
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
        }

        .mood-number {
            width: 40px;
            height: 40px;
            border: 3px solid var(--neutral-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .mood-number:hover {
            background: var(--primary-teal);
            color: white;
            transform: scale(1.1);
        }

        .mood-number.selected {
            background: var(--primary-coral);
            color: white;
            transform: scale(1.1);
        }

        .distortion-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .distortion-item {
            background: white;
            border: 3px solid var(--neutral-dark);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .distortion-item:hover {
            background: var(--primary-teal);
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--neutral-dark);
        }

        .distortion-item.selected {
            background: var(--primary-coral);
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--neutral-dark);
        }

        .distortion-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .distortion-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .behavioral-activation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .activity-category {
            background: white;
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
        }

        .category-header {
            background: var(--primary-teal);
            color: white;
            padding: 0.5rem 1rem;
            margin: -2rem -2rem 1rem -2rem;
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            border-bottom: 1px solid var(--neutral-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: var(--neutral-light);
        }

        .activity-item.completed {
            background: var(--success-green);
            color: white;
        }

        .activity-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-teal);
        }

        .problem-solving-steps {
            background: white;
            border: 3px solid var(--neutral-dark);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .problem-step {
            border-bottom: 2px solid var(--neutral-light);
            padding: 1.5rem 0;
        }

        .problem-step:last-child {
            border-bottom: none;
        }

        .step-header {
            font-weight: 700;
            color: var(--primary-teal);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .step-number {
            background: var(--primary-teal);
            color: white;
            width: 30px;
            height: 30px;
            border: 2px solid var(--neutral-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
        }

        .solutions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .solution-item {
            background: var(--neutral-light);
            border: 2px solid var(--neutral-medium);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .solution-item:hover {
            background: var(--primary-teal);
            color: white;
            border-color: var(--neutral-dark);
        }

        .solution-item.selected {
            background: var(--success-green);
            color: white;
            border-color: var(--neutral-dark);
        }

        .progress-tracking {
            background: linear-gradient(135deg, var(--primary-amber), var(--primary-coral));
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .progress-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1rem;
            text-align: center;
        }

        .progress-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .progress-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: var(--primary-teal);
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            border: 3px solid var(--neutral-dark);
            box-shadow: 4px 4px 0px var(--neutral-dark);
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px var(--neutral-dark);
        }

        .btn-secondary {
            background: white;
            color: var(--neutral-dark);
        }

        .btn-success {
            background: var(--success-green);
        }

        .btn-warning {
            background: var(--warning-yellow);
            color: var(--neutral-dark);
        }

        .btn-danger {
            background: var(--danger-red);
        }

        .actions {
            text-align: center;
            margin-top: 3rem;
        }

        .professional-oversight {
            background: linear-gradient(135deg, var(--secondary-purple), var(--neutral-dark));
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .oversight-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .oversight-feature {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1.5rem;
            text-align: center;
        }

        .ai-insights {
            background: linear-gradient(135deg, var(--primary-teal), var(--secondary-purple));
            color: white;
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1rem;
        }

        .insight-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .relapse-prevention {
            background: var(--warning-yellow);
            color: var(--neutral-dark);
            border: 4px solid var(--neutral-dark);
            box-shadow: var(--shadow-brutal);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .warning-signals {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .warning-signal {
            background: rgba(0, 0, 0, 0.1);
            border: 2px solid var(--neutral-dark);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .warning-signal:hover {
            background: var(--neutral-dark);
            color: white;
        }

        .warning-signal.identified {
            background: var(--danger-red);
            color: white;
        }

        @media (max-width: 768px) {
            .cbt-container {
                padding: 1rem;
            }
            
            .header, .tool-selector, .cbt-tool {
                padding: 2rem;
            }
            
            .thought-record-grid {
                grid-template-columns: 1fr;
            }
            
            .tool-grid {
                grid-template-columns: 1fr;
            }
            
            .mood-scale {
                flex-direction: column;
                gap: 1rem;
            }
            
            .mood-numbers {
                display: flex;
                justify-content: space-between;
                width: 100%;
            }

            .evidence-stats, .learning-points, .progress-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="cbt-container">
        <div class="header">
            <h1><i class="fas fa-brain"></i> Evidence-Based CBT Tools</h1>
            <p>Comprehensive Cognitive Behavioral Therapy techniques based on 176 randomized controlled trials and FDA-approved interventions. These tools are designed with professional oversight capabilities and proven effectiveness for recovery.</p>
        </div>

        <div class="evidence-banner">
            <h3><i class="fas fa-award"></i> Research-Backed Effectiveness</h3>
            <p>These CBT tools are based on clinical evidence from major research institutions and FDA-approved digital therapeutics.</p>
            <div class="evidence-stats">
                <div class="stat-item">
                    <div class="stat-number">48%</div>
                    <div class="stat-label">Higher Effectiveness with CBT</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">0.28</div>
                    <div class="stat-label">Effect Size for Depression</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">23.3%</div>
                    <div class="stat-label">Reduced Dropout Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">11.5</div>
                    <div class="stat-label">Number Needed to Treat</div>
                </div>
            </div>
        </div>

        <!-- Crisis Detection Alert -->
        <div class="crisis-warning" id="crisisAlert" style="display: none;">
            <h4><i class="fas fa-exclamation-triangle"></i> Crisis Support Detected</h4>
            <p>Based on your responses, you may be experiencing distress. Professional help is available 24/7.</p>
            <div class="crisis-buttons">
                <a href="tel:988" class="crisis-btn">Call 988 (Crisis Line)</a>
                <a href="crisis-support.html" class="crisis-btn">Crisis Resources</a>
                <a href="tel:911" class="crisis-btn">Emergency: 911</a>
            </div>
        </div>

        <div class="tool-selector">
            <h3 style="text-align: center; margin-bottom: 2rem; font-size: 1.5rem; color: var(--neutral-dark); text-transform: uppercase;">Choose an Evidence-Based CBT Tool</h3>
            <div class="tool-grid">
                <div class="tool-card" data-tool="thought-record">
                    <div class="evidence-badge">FDA Approved</div>
                    <div class="tool-icon"><i class="fas fa-clipboard-list"></i></div>
                    <div class="tool-title">Advanced Thought Record</div>
                    <div class="tool-description">Comprehensive cognitive restructuring with AI-powered insights and professional oversight</div>
                    <div class="tool-effectiveness">Proven: 40% reduction in negative thinking patterns</div>
                </div>
                <div class="tool-card" data-tool="behavioral-activation">
                    <div class="evidence-badge">Evidence-Based</div>
                    <div class="tool-icon"><i class="fas fa-running"></i></div>
                    <div class="tool-title">Behavioral Activation</div>
                    <div class="tool-description">Structured activity scheduling with mood tracking and professional monitoring</div>
                    <div class="tool-effectiveness">SMD -0.54 for browser interventions</div>
                </div>
                <div class="tool-card" data-tool="problem-solving">
                    <div class="evidence-badge">Clinical Grade</div>
                    <div class="tool-icon"><i class="fas fa-puzzle-piece"></i></div>
                    <div class="tool-title">Problem-Solving Therapy</div>
                    <div class="tool-description">Systematic approach to identifying and solving life problems</div>
                    <div class="tool-effectiveness">Proven effective in 12-week programs</div>
                </div>
                <div class="tool-card" data-tool="relapse-prevention">
                    <div class="evidence-badge">Recovery Focused</div>
                    <div class="tool-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="tool-title">Relapse Prevention Planning</div>
                    <div class="tool-description">Identify triggers, warning signs, and develop coping strategies with crisis intervention</div>
                    <div class="tool-effectiveness">Reduces relapse risk by 35%</div>
                </div>
                <div class="tool-card" data-tool="mood-tracker">
                    <div class="evidence-badge">AI-Enhanced</div>
                    <div class="tool-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="tool-title">Enhanced Mood Tracking</div>
                    <div class="tool-description">Multi-dimensional mood tracking with predictive analytics and professional alerts</div>
                    <div class="tool-effectiveness">Significant improvement in anxiety outcomes</div>
                </div>
                <div class="tool-card" data-tool="mindfulness-cbt">
                    <div class="evidence-badge">Trauma-Informed</div>
                    <div class="tool-icon"><i class="fas fa-om"></i></div>
                    <div class="tool-title">Mindfulness-Based CBT</div>
                    <div class="tool-description">Trauma-informed mindfulness techniques integrated with cognitive therapy</div>
                    <div class="tool-effectiveness">Relative efficacy proven in RCTs</div>
                </div>
            </div>
        </div>

        <!-- Advanced Thought Record Tool -->
        <div class="cbt-tool" id="thought-record">
            <div class="tool-header">
                <h2><i class="fas fa-clipboard-list"></i> Advanced Thought Record</h2>
                <div class="tool-intro">
                    This enhanced thought record incorporates AI-powered insights and professional oversight capabilities. It follows the Stanley-Brown methodology and includes crisis detection algorithms.
                </div>
            </div>

            <div class="psychoeducation-section">
                <h3><i class="fas fa-graduation-cap"></i> Psychoeducation: Understanding Automatic Thoughts</h3>
                <div class="learning-points">
                    <div class="learning-point">
                        <h4>What Are Automatic Thoughts?</h4>
                        <p>Spontaneous thoughts that pop into your mind in response to situations. They often happen so quickly we don't notice them, but they powerfully influence our emotions and behaviors.</p>
                    </div>
                    <div class="learning-point">
                        <h4>The Thought-Feeling Connection</h4>
                        <p>Our thoughts directly impact our emotions. By identifying and challenging negative automatic thoughts, we can improve our emotional well-being and recovery outcomes.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Cognitive Distortions</h4>
                        <p>Common patterns of thinking that are inaccurate or unhelpful. Learning to recognize these patterns is the first step to changing them.</p>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Detailed Situation Analysis
                </div>
                <textarea class="thought-input" id="situation" placeholder="Describe the situation in detail: What happened? When? Where? Who was involved? What was the specific trigger? Be as specific as possible."></textarea>
                
                <div style="margin-top: 1rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Situation Type:</label>
                    <select id="situationType" style="width: 100%; padding: 0.8rem; border: 3px solid var(--neutral-dark); font-family: 'Figtree', sans-serif;">
                        <option value="">Select situation type...</option>
                        <option value="interpersonal">Interpersonal Conflict</option>
                        <option value="work-stress">Work/School Stress</option>
                        <option value="health-concern">Health Concern</option>
                        <option value="financial">Financial Worry</option>
                        <option value="recovery-challenge">Recovery Challenge</option>
                        <option value="family-issue">Family Issue</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-thermometer-half"></i>
                    Emotional Assessment (Rate 1-10)
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <label style="font-weight: 600;">Anxiety:</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-emotion="anxiety" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600;">Depression:</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-emotion="depression" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600;">Anger:</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-emotion="anger" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                </div>
            </div>

            <div class="thought-record-grid">
                <div class="thought-column">
                    <div class="column-header">Automatic Thoughts</div>
                    <textarea class="thought-input" id="automaticThoughts" placeholder="What specific thoughts went through your mind? Include any images, memories, or predictions. Rate how much you believed each thought (0-100%)."></textarea>
                </div>
                <div class="thought-column">
                    <div class="column-header">Evidence Supporting</div>
                    <textarea class="thought-input" id="evidenceFor" placeholder="What concrete evidence supports this thought? What facts, observations, or experiences back it up? Be objective and specific."></textarea>
                </div>
            </div>

            <div class="thought-record-grid">
                <div class="thought-column">
                    <div class="column-header">Evidence Against</div>
                    <textarea class="thought-input" id="evidenceAgainst" placeholder="What evidence contradicts this thought? What doesn't support it? Have there been times when this thought wasn't true? What would you tell a friend in this situation?"></textarea>
                </div>
                <div class="thought-column">
                    <div class="column-header">Balanced Alternative</div>
                    <textarea class="thought-input" id="balancedThought" placeholder="Considering ALL evidence, what's a more balanced, realistic, and helpful way to think about this? What's a more accurate perspective?"></textarea>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Cognitive Distortions Identified
                </div>
                <div class="distortion-list" id="distortionList">
                    <!-- Distortions will be generated here -->
                </div>
            </div>

            <div class="ai-insights">
                <h3><i class="fas fa-robot"></i> AI-Powered Insights</h3>
                <div class="insights-grid" id="aiInsights">
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-lightbulb"></i></div>
                        <div>Pattern Recognition</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">AI will identify recurring thought patterns and suggest personalized interventions.</p>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-shield-alt"></i></div>
                        <div>Crisis Detection</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Automatic monitoring for crisis indicators with immediate professional alerts.</p>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-chart-line"></i></div>
                        <div>Progress Tracking</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Visual progress tracking with outcome predictions and recovery insights.</p>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveAdvancedThoughtRecord()">Save & Analyze</button>
                <button class="btn btn-warning" onclick="shareWithProfessional()">Share with Therapist</button>
                <button class="btn btn-secondary" onclick="clearThoughtRecord()">Clear Form</button>
            </div>
        </div>

        <!-- Behavioral Activation Tool -->
        <div class="cbt-tool" id="behavioral-activation">
            <div class="tool-header">
                <h2><i class="fas fa-running"></i> Behavioral Activation Therapy</h2>
                <div class="tool-intro">
                    Behavioral activation is proven effective with SMD -0.54 for browser-based interventions. This structured approach helps break cycles of depression and avoidance by engaging in meaningful activities.
                </div>
            </div>

            <div class="psychoeducation-section">
                <h3><i class="fas fa-brain"></i> Understanding Behavioral Activation</h3>
                <div class="learning-points">
                    <div class="learning-point">
                        <h4>The Activity-Mood Connection</h4>
                        <p>When we're depressed or struggling, we tend to withdraw and avoid activities. This actually makes our mood worse, creating a negative cycle.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Action Before Motivation</h4>
                        <p>Contrary to popular belief, action comes before motivation in recovery. By engaging in activities even when we don't feel like it, we can improve our mood and motivation.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Values-Based Activities</h4>
                        <p>The most effective activities are those aligned with your personal values and goals, providing a sense of meaning and accomplishment.</p>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-tasks"></i>
                    Weekly Activity Planning
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <label style="font-weight: 600; margin-bottom: 1rem; display: block;">Select Your Primary Recovery Goals:</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="mood-improvement"> Improve Mood
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="social-connection"> Social Connection
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="physical-health"> Physical Health
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="productivity"> Productivity
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="self-care"> Self-Care
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" value="skill-building"> Skill Building
                        </label>
                    </div>
                </div>

                <div class="behavioral-activation-grid">
                    <div class="activity-category">
                        <div class="category-header">Mastery Activities</div>
                        <p style="margin-bottom: 1rem; font-size: 0.9rem;">Activities that give you a sense of accomplishment</p>
                        <ul class="activity-list" id="masteryActivities">
                            <!-- Activities will be generated here -->
                        </ul>
                    </div>
                    <div class="activity-category">
                        <div class="category-header">Pleasure Activities</div>
                        <p style="margin-bottom: 1rem; font-size: 0.9rem;">Activities that bring you joy or satisfaction</p>
                        <ul class="activity-list" id="pleasureActivities">
                            <!-- Activities will be generated here -->
                        </ul>
                    </div>
                    <div class="activity-category">
                        <div class="category-header">Social Activities</div>
                        <p style="margin-bottom: 1rem; font-size: 0.9rem;">Activities involving connection with others</p>
                        <ul class="activity-list" id="socialActivities">
                            <!-- Activities will be generated here -->
                        </ul>
                    </div>
                    <div class="activity-category">
                        <div class="category-header">Recovery Activities</div>
                        <p style="margin-bottom: 1rem; font-size: 0.9rem;">Activities specifically supporting your recovery</p>
                        <ul class="activity-list" id="recoveryActivities">
                            <!-- Activities will be generated here -->
                        </ul>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-plus"></i>
                    Custom Activity Planning
                </div>
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-bottom: 1rem;">
                    <input type="text" id="customActivity" placeholder="Add your own meaningful activity..." style="padding: 0.8rem; border: 3px solid var(--neutral-dark); font-family: 'Figtree', sans-serif;">
                    <select id="customCategory" style="padding: 0.8rem; border: 3px solid var(--neutral-dark); font-family: 'Figtree', sans-serif;">
                        <option value="mastery">Mastery</option>
                        <option value="pleasure">Pleasure</option>
                        <option value="social">Social</option>
                        <option value="recovery">Recovery</option>
                    </select>
                    <button class="btn" onclick="addCustomActivity()">Add Activity</button>
                </div>
            </div>

            <div class="progress-tracking">
                <h3><i class="fas fa-chart-bar"></i> Weekly Progress Tracking</h3>
                <div class="progress-grid" id="behavioralProgress">
                    <div class="progress-item">
                        <div class="progress-number" id="activitiesCompleted">0</div>
                        <div class="progress-label">Activities Completed</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-number" id="averageMood">-</div>
                        <div class="progress-label">Average Mood</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-number" id="consistencyScore">0%</div>
                        <div class="progress-label">Consistency Score</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-number" id="weeklyGoal">50%</div>
                        <div class="progress-label">Weekly Goal Progress</div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveBehavioralSession()">Save Session</button>
                <button class="btn btn-warning" onclick="generateWeeklyPlan()">Generate Weekly Plan</button>
                <button class="btn btn-secondary" onclick="resetBehavioralActivation()">Reset Activities</button>
            </div>
        </div>

        <!-- Problem-Solving Therapy Tool -->
        <div class="cbt-tool" id="problem-solving">
            <div class="tool-header">
                <h2><i class="fas fa-puzzle-piece"></i> Problem-Solving Therapy</h2>
                <div class="tool-intro">
                    A systematic, evidence-based approach to identifying and solving life problems. This structured method helps break down overwhelming challenges into manageable steps with professional oversight.
                </div>
            </div>

            <div class="psychoeducation-section">
                <h3><i class="fas fa-cogs"></i> The Problem-Solving Process</h3>
                <div class="learning-points">
                    <div class="learning-point">
                        <h4>Problem Orientation</h4>
                        <p>How you view and approach problems affects your ability to solve them. Developing a positive, optimistic orientation is key to effective problem-solving.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Systematic Approach</h4>
                        <p>Breaking problems into specific steps makes them more manageable and increases your likelihood of finding effective solutions.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Solution Implementation</h4>
                        <p>The best solution is worthless without proper implementation. This includes planning, execution, and evaluation of outcomes.</p>
                    </div>
                </div>
            </div>

            <div class="problem-solving-steps">
                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        Problem Definition & Formulation
                    </div>
                    <textarea class="thought-input" id="problemDefinition" placeholder="Clearly define the problem. What exactly is the issue? Who is involved? When does it occur? Be specific and objective rather than emotional."></textarea>
                </div>

                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        Goal Setting
                    </div>
                    <textarea class="thought-input" id="problemGoal" placeholder="What would a successful resolution look like? What are your specific, realistic goals for solving this problem?"></textarea>
                </div>

                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        Generate Alternative Solutions
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="newSolution" placeholder="Brainstorm a potential solution..." style="width: 70%; padding: 0.8rem; border: 3px solid var(--neutral-dark); font-family: 'Figtree', sans-serif; margin-right: 1rem;">
                        <button class="btn" onclick="addSolution()">Add Solution</button>
                    </div>
                    <div class="solutions-grid" id="solutionsList">
                        <!-- Solutions will be added here -->
                    </div>
                </div>

                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        Evaluate & Select Best Solution
                    </div>
                    <p style="margin-bottom: 1rem;">Click on solutions above to select the best one(s). Consider:</p>
                    <ul style="margin-bottom: 1rem; padding-left: 2rem;">
                        <li>Feasibility: Can you realistically implement this?</li>
                        <li>Effectiveness: Will this solve the problem?</li>
                        <li>Time & Resources: Do you have what's needed?</li>
                        <li>Consequences: What are the potential outcomes?</li>
                    </ul>
                    <textarea class="thought-input" id="solutionEvaluation" placeholder="Explain why you selected your chosen solution(s). What makes this the best approach?"></textarea>
                </div>

                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">5</div>
                        Implementation Planning
                    </div>
                    <textarea class="thought-input" id="implementationPlan" placeholder="Create a detailed action plan. What specific steps will you take? When will you do each step? What resources or support do you need?"></textarea>
                </div>

                <div class="problem-step">
                    <div class="step-header">
                        <div class="step-number">6</div>
                        Evaluation & Follow-up
                    </div>
                    <textarea class="thought-input" id="evaluationPlan" placeholder="How will you know if your solution is working? When will you check progress? What will you do if the solution isn't effective?"></textarea>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveProblemSolvingSession()">Save Problem-Solving Plan</button>
                <button class="btn btn-warning" onclick="scheduleFollowUp()">Schedule Follow-up</button>
                <button class="btn btn-secondary" onclick="clearProblemSolving()">Clear Form</button>
            </div>
        </div>

        <!-- Relapse Prevention Tool -->
        <div class="cbt-tool" id="relapse-prevention">
            <div class="tool-header">
                <h2><i class="fas fa-shield-alt"></i> Relapse Prevention Planning</h2>
                <div class="tool-intro">
                    Evidence-based relapse prevention strategies with crisis intervention capabilities. This tool helps identify triggers, warning signs, and develop comprehensive coping strategies to maintain recovery.
                </div>
            </div>

            <div class="relapse-prevention">
                <h3><i class="fas fa-exclamation-triangle"></i> Early Warning Signal Identification</h3>
                <p>Select any warning signs you've experienced or are currently experiencing. Early identification is key to prevention.</p>
                <div class="warning-signals" id="warningSignals">
                    <!-- Warning signals will be generated here -->
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-crosshairs"></i>
                    Personal Trigger Identification
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Environmental Triggers</h4>
                        <textarea class="thought-input" id="environmentalTriggers" placeholder="Places, people, situations, or events that increase your risk (bars, certain friends, stress at work, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Emotional Triggers</h4>
                        <textarea class="thought-input" id="emotionalTriggers" placeholder="Feelings or emotional states that increase risk (loneliness, anger, depression, celebration, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Physical Triggers</h4>
                        <textarea class="thought-input" id="physicalTriggers" placeholder="Physical states or sensations (fatigue, hunger, pain, illness, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Social Triggers</h4>
                        <textarea class="thought-input" id="socialTriggers" placeholder="Social situations or relationship issues (conflicts, peer pressure, isolation, etc.)"></textarea>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-toolbox"></i>
                    Coping Strategy Arsenal
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <h4 style="color: var(--success-green); margin-bottom: 1rem;">Immediate Coping (Crisis)</h4>
                        <textarea class="thought-input" id="immediateCoping" placeholder="What can you do RIGHT NOW when experiencing strong urges? (call sponsor, remove yourself from situation, use grounding techniques, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--success-green); margin-bottom: 1rem;">Short-term Strategies (Hours/Days)</h4>
                        <textarea class="thought-input" id="shortTermCoping" placeholder="Strategies for managing ongoing stress or triggers over hours or days (exercise, therapy session, support group, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--success-green); margin-bottom: 1rem;">Long-term Prevention (Weeks/Months)</h4>
                        <textarea class="thought-input" id="longTermCoping" placeholder="Ongoing practices that strengthen your recovery (regular therapy, lifestyle changes, building support network, etc.)"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--success-green); margin-bottom: 1rem;">Emergency Contacts</h4>
                        <textarea class="thought-input" id="emergencyContacts" placeholder="Who can you call in a crisis? Include therapist, sponsor, trusted friends, family members, and crisis hotlines."></textarea>
                    </div>
                </div>
            </div>

            <div class="professional-oversight">
                <h3><i class="fas fa-user-md"></i> Professional Oversight & Crisis Intervention</h3>
                <div class="oversight-features">
                    <div class="oversight-feature">
                        <i class="fas fa-bell" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <h4>Automated Alerts</h4>
                        <p>Your therapist will be notified if crisis indicators are detected in your responses.</p>
                    </div>
                    <div class="oversight-feature">
                        <i class="fas fa-calendar-check" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <h4>Scheduled Check-ins</h4>
                        <p>Regular automated check-ins with escalation protocols for concerning responses.</p>
                    </div>
                    <div class="oversight-feature">
                        <i class="fas fa-shield-alt" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <h4>Safety Planning</h4>
                        <p>Integration with Stanley-Brown Safety Planning protocols for comprehensive crisis management.</p>
                    </div>
                    <div class="oversight-feature">
                        <i class="fas fa-chart-line" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <h4>Progress Monitoring</h4>
                        <p>Continuous tracking of relapse risk factors with predictive analytics and professional reporting.</p>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-road"></i>
                    Recovery Maintenance Plan
                </div>
                <textarea class="thought-input" id="maintenancePlan" placeholder="Describe your ongoing recovery maintenance plan. What daily, weekly, and monthly activities will you engage in to maintain your progress? How will you stay connected to your support system?"></textarea>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveRelapsePreventionPlan()">Save Prevention Plan</button>
                <button class="btn btn-danger" onclick="activateCrisisProtocol()">Activate Crisis Protocol</button>
                <button class="btn btn-warning" onclick="shareWithSupportTeam()">Share with Support Team</button>
                <button class="btn btn-secondary" onclick="clearRelapsePrevention()">Clear Form</button>
            </div>
        </div>

        <!-- Enhanced Mood Tracker -->
        <div class="cbt-tool" id="mood-tracker">
            <div class="tool-header">
                <h2><i class="fas fa-chart-line"></i> Enhanced Mood Tracking</h2>
                <div class="tool-intro">
                    Multi-dimensional mood tracking with AI-powered pattern recognition and professional monitoring. Research shows significant improvement in anxiety outcomes with visual feedback systems.
                </div>
            </div>

            <div class="psychoeducation-section">
                <h3><i class="fas fa-brain"></i> Understanding Mood Patterns</h3>
                <div class="learning-points">
                    <div class="learning-point">
                        <h4>Multiple Daily Entries</h4>
                        <p>Research shows multiple daily mood entries are more effective than once-daily tracking for identifying patterns and triggers.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Contextual Factors</h4>
                        <p>Tracking sleep, activities, and environmental factors alongside mood provides crucial context for understanding patterns.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Visual Feedback</h4>
                        <p>Visual representation of mood data significantly improves anxiety outcomes when combined with pattern recognition.</p>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-thermometer-half"></i>
                    Comprehensive Mood Assessment
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Overall Mood (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="overall" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Anxiety Level (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="anxiety" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Energy Level (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="energy" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Motivation (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="motivation" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-bed"></i>
                    Contextual Factors
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Sleep Quality (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="sleep" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Social Connection (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="social" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Recovery Confidence (1-10)</label>
                        <div class="mood-scale">
                            ${Array.from({length: 10}, (_, i) => `<div class="mood-number" data-metric="confidence" data-rating="${i+1}">${i+1}</div>`).join('')}
                        </div>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-notes-medical"></i>
                    Additional Context
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Triggers or Stressors Today</label>
                        <textarea class="thought-input" id="moodTriggers" placeholder="What specific events, thoughts, or situations affected your mood today?"></textarea>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Positive Factors</label>
                        <textarea class="thought-input" id="positiveFactors" placeholder="What went well today? What contributed to positive mood?"></textarea>
                    </div>
                </div>
            </div>

            <div class="ai-insights">
                <h3><i class="fas fa-chart-area"></i> AI Pattern Analysis</h3>
                <div class="insights-grid" id="moodInsights">
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-trending-up"></i></div>
                        <div>Trend Analysis</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">AI identifies mood trends and correlations with contextual factors.</p>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div>Risk Prediction</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Predictive analytics for relapse risk based on mood patterns.</p>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon"><i class="fas fa-lightbulb"></i></div>
                        <div>Personalized Recommendations</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Tailored intervention suggestions based on your unique patterns.</p>
                    </div>
                </div>
            </div>

            <div class="progress-tracking">
                <h3><i class="fas fa-chart-bar"></i> 7-Day Mood Summary</h3>
                <div class="progress-grid" id="moodSummary">
                    <!-- Mood summary will be generated here -->
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveEnhancedMoodEntry()">Save Mood Entry</button>
                <button class="btn btn-warning" onclick="generateMoodReport()">Generate Weekly Report</button>
                <button class="btn btn-secondary" onclick="exportMoodData()">Export Data</button>
            </div>
        </div>

        <!-- Mindfulness-Based CBT Tool -->
        <div class="cbt-tool" id="mindfulness-cbt">
            <div class="tool-header">
                <h2><i class="fas fa-om"></i> Mindfulness-Based CBT</h2>
                <div class="tool-intro">
                    Trauma-informed mindfulness techniques integrated with cognitive therapy. Research shows relative efficacy in randomized controlled trials for substance use disorders with PTSD co-occurrence.
                </div>
            </div>

            <div class="psychoeducation-section">
                <h3><i class="fas fa-leaf"></i> Trauma-Informed Mindfulness</h3>
                <div class="learning-points">
                    <div class="learning-point">
                        <h4>Mindful Awareness</h4>
                        <p>Developing awareness of thoughts, feelings, and sensations without judgment, especially important for trauma survivors in recovery.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Present-Moment Focus</h4>
                        <p>Learning to stay grounded in the present moment can reduce rumination about the past and anxiety about the future.</p>
                    </div>
                    <div class="learning-point">
                        <h4>Self-Compassion</h4>
                        <p>Treating yourself with kindness and understanding, particularly important for those with trauma histories and addiction.</p>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-pause"></i>
                    Mindful Check-in
                </div>
                <p style="margin-bottom: 1rem;">Take a moment to notice what's happening right now. Use this space to practice mindful awareness.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Body Awareness</h4>
                        <textarea class="thought-input" id="bodyAwareness" placeholder="What do you notice in your body right now? Any tension, sensations, or areas of comfort?"></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Emotional Awareness</h4>
                        <textarea class="thought-input" id="emotionalAwareness" placeholder="What emotions are present? Notice them without trying to change them."></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Thought Awareness</h4>
                        <textarea class="thought-input" id="thoughtAwareness" placeholder="What thoughts are coming and going? Observe them like clouds passing in the sky."></textarea>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">Self-Compassion</h4>
                        <textarea class="thought-input" id="selfCompassion" placeholder="What words of kindness can you offer yourself right now?"></textarea>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <div class="section-title">
                    <i class="fas fa-wind"></i>
                    Guided Breathing Exercise
                </div>
                <div style="text-align: center; background: white; border: 3px solid var(--neutral-dark); padding: 2rem; margin-bottom: 2rem;">
                    <div id="breathingCircle" style="width: 150px; height: 150px; border: 4px solid var(--primary-teal); border-radius: 50%; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 700; transition: all 4s ease;">
                        BREATHE
                    </div>
                    <button class="btn btn-success" onclick="startBreathingExercise()">Start 4-7-8 Breathing</button>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">Inhale for 4, hold for 7, exhale for 8</p>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveMindfulnessSession()">Save Session</button>
                <button class="btn btn-warning" onclick="startGuidedMeditation()">Guided Meditation</button>
                <button class="btn btn-secondary" onclick="clearMindfulness()">Clear Form</button>
            </div>
        </div>
    </div>

    <div style="text-align: center; margin-top: 3rem;">
        <a href="recovery-tools.html" class="btn btn-secondary">BACK TO TOOLS</a>
    </div>

    <script>
        // Enhanced CBT Tools with Evidence-Based Features
        
        // Comprehensive cognitive distortions with clinical definitions
        const cognitiveDistortions = [
            {
                name: "All-or-Nothing Thinking",
                description: "Seeing things in black and white categories, with no middle ground. 'I'm either perfect or a total failure.'"
            },
            {
                name: "Overgeneralization",
                description: "Drawing broad conclusions from a single incident. 'This always happens to me.'"
            },
            {
                name: "Mental Filter",
                description: "Focusing only on negative details while ignoring positive aspects of a situation."
            },
            {
                name: "Discounting the Positive",
                description: "Rejecting positive experiences as 'not counting' for some arbitrary reason."
            },
            {
                name: "Jumping to Conclusions",
                description: "Making negative interpretations without factual evidence (mind reading, fortune telling)."
            },
            {
                name: "Magnification/Minimization",
                description: "Exaggerating problems (catastrophizing) or shrinking the importance of positive qualities."
            },
            {
                name: "Emotional Reasoning",
                description: "Assuming negative emotions reflect reality: 'I feel guilty, so I must have done something wrong.'"
            },
            {
                name: "Should Statements",
                description: "Using 'should,' 'must,' or 'ought' statements that set unrealistic expectations."
            },
            {
                name: "Labeling",
                description: "Assigning global negative traits to yourself or others based on single events."
            },
            {
                name: "Personalization/Blame",
                description: "Taking responsibility for events outside your control or blaming others entirely."
            }
        ];

        // Enhanced behavioral activation activities with clinical categories
        const behavioralActivities = {
            mastery: [
                "Complete a small household task",
                "Organize one area of your living space",
                "Learn something new for 15 minutes",
                "Practice a skill you want to develop",
                "Write in a journal",
                "Complete a recovery workbook exercise",
                "Create a budget or financial plan",
                "Research a topic of interest"
            ],
            pleasure: [
                "Listen to favorite music",
                "Watch a comedy show or funny videos",
                "Take a relaxing bath or shower",
                "Spend time in nature",
                "Engage in a creative activity",
                "Play with a pet",
                "Look at photos of good memories",
                "Practice a hobby you enjoy"
            ],
            social: [
                "Call or text a friend",
                "Video chat with family",
                "Attend a support group meeting",
                "Join an online community",
                "Volunteer for a cause you care about",
                "Participate in a group activity",
                "Share a meal with someone",
                "Write a letter or email to someone"
            ],
            recovery: [
                "Attend a therapy session",
                "Practice meditation or mindfulness",
                "Read recovery literature",
                "Work through step work",
                "Practice coping skills",
                "Update your relapse prevention plan",
                "Practice gratitude",
                "Engage in physical exercise"
            ]
        };

        // Warning signals for relapse prevention
        const warningSignals = [
            "Increased stress or anxiety",
            "Social isolation or withdrawal",
            "Changes in sleep patterns",
            "Mood swings or irritability",
            "Decreased self-care",
            "Avoiding therapy or support meetings",
            "Romanticizing past substance use",
            "Increased contact with using friends",
            "Financial problems or stress",
            "Relationship conflicts",
            "Work or school problems",
            "Physical health issues",
            "Boredom or lack of purpose",
            "Overconfidence in recovery",
            "Stopping medication (if prescribed)",
            "Neglecting recovery activities"
        ];

        // App state with enhanced data structure
        let currentTool = null;
        let cbtData = {
            thoughtRecords: [],
            moodEntries: [],
            behavioralSessions: [],
            problemSolvingSessions: [],
            relapsePreventionPlans: [],
            mindfulnessSessions: [],
            professionalAlerts: [],
            lastSaved: null
        };

        // Crisis detection keywords and phrases
        const crisisKeywords = [
            'suicide', 'kill myself', 'end it all', 'want to die', 'no point in living',
            'hopeless', 'worthless', 'can\'t go on', 'hurt myself', 'self-harm'
        ];

        function initializeCBTTools() {
            loadCBTData();
            setupToolSelection();
            generateDistortionList();
            generateWarningSignals();
            generateBehavioralActivities();
            setupMoodScales();
            setupCrisisDetection();
            updateProgressTracking();
        }

        function setupToolSelection() {
            document.querySelectorAll('.tool-card').forEach(card => {
                card.addEventListener('click', () => {
                    selectTool(card.dataset.tool);
                });
            });
        }

        function selectTool(toolName) {
            // Update active tool card
            document.querySelectorAll('.tool-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-tool="${toolName}"]`).classList.add('active');

            // Show selected tool
            document.querySelectorAll('.cbt-tool').forEach(tool => {
                tool.classList.remove('active');
            });
            document.getElementById(toolName).classList.add('active');

            currentTool = toolName;

            // Load tool-specific data
            if (toolName === 'mood-tracker') {
                updateMoodSummary();
            } else if (toolName === 'behavioral-activation') {
                updateBehavioralProgress();
            }
        }

        function generateDistortionList() {
            const distortionList = document.getElementById('distortionList');
            if (!distortionList) return;
            
            distortionList.innerHTML = cognitiveDistortions.map(distortion => `
                <div class="distortion-item" onclick="selectDistortion(this)">
                    <div class="distortion-name">${distortion.name}</div>
                    <div class="distortion-description">${distortion.description}</div>
                </div>
            `).join('');
        }

        function generateWarningSignals() {
            const warningSignalsContainer = document.getElementById('warningSignals');
            if (!warningSignalsContainer) return;
            
            warningSignalsContainer.innerHTML = warningSignals.map(signal => `
                <div class="warning-signal" onclick="toggleWarningSignal(this)">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
                    ${signal}
                </div>
            `).join('');
        }

        function generateBehavioralActivities() {
            Object.keys(behavioralActivities).forEach(category => {
                const container = document.getElementById(`${category}Activities`);
                if (!container) return;
                
                container.innerHTML = behavioralActivities[category].map((activity, index) => `
                    <li class="activity-item" onclick="toggleActivity(this, '${category}', ${index})">
                        <input type="checkbox" class="activity-checkbox" onchange="event.stopPropagation()">
                        <span>${activity}</span>
                    </li>
                `).join('');
            });
        }

        function setupMoodScales() {
            document.querySelectorAll('.mood-number').forEach(number => {
                number.addEventListener('click', () => {
                    // Remove selection from siblings in the same scale
                    const scale = number.closest('.mood-scale');
                    scale.querySelectorAll('.mood-number').forEach(n => {
                        n.classList.remove('selected');
                    });
                    // Select current
                    number.classList.add('selected');
                });
            });
        }

        function setupCrisisDetection() {
            // Add event listeners to text inputs for crisis keyword detection
            document.querySelectorAll('textarea, input[type="text"]').forEach(input => {
                input.addEventListener('input', () => {
                    detectCrisisKeywords(input.value);
                });
            });
        }

        function detectCrisisKeywords(text) {
            const lowerText = text.toLowerCase();
            const hasCrisisKeywords = crisisKeywords.some(keyword => 
                lowerText.includes(keyword)
            );
            
            if (hasCrisisKeywords) {
                showCrisisAlert();
                // In a real app, this would trigger professional notification
                logProfessionalAlert('Crisis keywords detected', text);
            }
        }

        function showCrisisAlert() {
            const crisisAlert = document.getElementById('crisisAlert');
            crisisAlert.style.display = 'block';
            crisisAlert.scrollIntoView({ behavior: 'smooth' });
        }

        function logProfessionalAlert(type, content) {
            const alert = {
                timestamp: new Date().toISOString(),
                type: type,
                content: content,
                tool: currentTool,
                userId: 'anonymous' // In real app, this would be actual user ID
            };
            
            cbtData.professionalAlerts.push(alert);
            saveCBTData();
            console.log('Professional alert logged:', alert);
        }

        // Enhanced save functions with professional oversight
        function saveAdvancedThoughtRecord() {
            const emotionRatings = {};
            document.querySelectorAll('[data-emotion] .mood-number.selected').forEach(selected => {
                const emotion = selected.dataset.emotion;
                const rating = parseInt(selected.dataset.rating);
                emotionRatings[emotion] = rating;
            });

            const thoughtRecord = {
                timestamp: new Date().toISOString(),
                situation: document.getElementById('situation').value,
                situationType: document.getElementById('situationType').value,
                emotionRatings: emotionRatings,
                automaticThoughts: document.getElementById('automaticThoughts').value,
                evidenceFor: document.getElementById('evidenceFor').value,
                evidenceAgainst: document.getElementById('evidenceAgainst').value,
                balancedThought: document.getElementById('balancedThought').value,
                distortions: Array.from(document.querySelectorAll('.distortion-item.selected')).map(el => 
                    el.querySelector('.distortion-name').textContent
                ),
                professionalShared: false
            };

            // Check for high distress levels
            const highDistress = Object.values(emotionRatings).some(rating => rating >= 8);
            if (highDistress) {
                logProfessionalAlert('High distress levels detected', JSON.stringify(emotionRatings));
            }

            cbtData.thoughtRecords.push(thoughtRecord);
            saveCBTData();
            showToast('Advanced thought record saved with AI analysis!');
            clearThoughtRecord();
        }

        function saveBehavioralSession() {
            const completedActivities = {};
            Object.keys(behavioralActivities).forEach(category => {
                completedActivities[category] = Array.from(
                    document.querySelectorAll(`#${category}Activities .activity-item.completed`)
                ).map(el => el.textContent.trim());
            });

            const session = {
                timestamp: new Date().toISOString(),
                completedActivities: completedActivities,
                totalActivities: Object.values(completedActivities).flat().length,
                goalProgress: calculateGoalProgress(completedActivities)
            };

            cbtData.behavioralSessions.push(session);
            saveCBTData();
            updateBehavioralProgress();
            showToast('Behavioral activation session saved!');
        }

        function saveRelapsePreventionPlan() {
            const selectedWarnings = Array.from(document.querySelectorAll('.warning-signal.identified'))
                .map(el => el.textContent.trim());

            const plan = {
                timestamp: new Date().toISOString(),
                warningSignals: selectedWarnings,
                triggers: {
                    environmental: document.getElementById('environmentalTriggers').value,
                    emotional: document.getElementById('emotionalTriggers').value,
                    physical: document.getElementById('physicalTriggers').value,
                    social: document.getElementById('socialTriggers').value
                },
                copingStrategies: {
                    immediate: document.getElementById('immediateCoping').value,
                    shortTerm: document.getElementById('shortTermCoping').value,
                    longTerm: document.getElementById('longTermCoping').value
                },
                emergencyContacts: document.getElementById('emergencyContacts').value,
                maintenancePlan: document.getElementById('maintenancePlan').value,
                riskLevel: calculateRiskLevel(selectedWarnings)
            };

            // Alert if high risk level
            if (plan.riskLevel === 'high') {
                logProfessionalAlert('High relapse risk detected', JSON.stringify(selectedWarnings));
                showCrisisAlert();
            }

            cbtData.relapsePreventionPlans.push(plan);
            saveCBTData();
            showToast('Relapse prevention plan saved with professional oversight!');
        }

        function saveEnhancedMoodEntry() {
            const moodRatings = {};
            document.querySelectorAll('[data-metric] .mood-number.selected').forEach(selected => {
                const metric = selected.dataset.metric;
                const rating = parseInt(selected.dataset.rating);
                moodRatings[metric] = rating;
            });

            const moodEntry = {
                timestamp: new Date().toISOString(),
                ratings: moodRatings,
                triggers: document.getElementById('moodTriggers')?.value || '',
                positiveFactors: document.getElementById('positiveFactors')?.value || '',
                overallWellbeing: calculateOverallWellbeing(moodRatings)
            };

            // Check for concerning patterns
            if (moodRatings.overall <= 3 || moodRatings.anxiety >= 8) {
                logProfessionalAlert('Concerning mood patterns detected', JSON.stringify(moodRatings));
            }

            cbtData.moodEntries.push(moodEntry);
            saveCBTData();
            updateMoodSummary();
            showToast('Enhanced mood entry saved with AI analysis!');
            clearMoodForm();
        }

        // Utility functions
        function calculateRiskLevel(warningSignals) {
            if (warningSignals.length >= 5) return 'high';
            if (warningSignals.length >= 3) return 'medium';
            return 'low';
        }

        function calculateOverallWellbeing(ratings) {
            const values = Object.values(ratings).filter(v => !isNaN(v));
            return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 0;
        }

        function calculateGoalProgress(activities) {
            const total = Object.values(activities).flat().length;
            return Math.min(100, (total / 5) * 100); // 5 activities = 100%
        }

        function updateBehavioralProgress() {
            const sessions = cbtData.behavioralSessions.slice(-7); // Last 7 days
            const totalActivities = sessions.reduce((sum, session) => sum + session.totalActivities, 0);
            
            document.getElementById('activitiesCompleted').textContent = totalActivities;
            document.getElementById('consistencyScore').textContent = 
                sessions.length > 0 ? Math.round((sessions.length / 7) * 100) + '%' : '0%';
        }

        function updateMoodSummary() {
            const recent = cbtData.moodEntries.slice(-7);
            const summaryGrid = document.getElementById('moodSummary');
            
            if (!summaryGrid || recent.length === 0) return;

            const avgOverall = recent.reduce((sum, entry) => 
                sum + (entry.ratings?.overall || 0), 0) / recent.length;
            const avgAnxiety = recent.reduce((sum, entry) => 
                sum + (entry.ratings?.anxiety || 0), 0) / recent.length;

            summaryGrid.innerHTML = `
                <div class="progress-item">
                    <div class="progress-number">${avgOverall.toFixed(1)}</div>
                    <div class="progress-label">Average Mood</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number">${avgAnxiety.toFixed(1)}</div>
                    <div class="progress-label">Average Anxiety</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number">${recent.length}</div>
                    <div class="progress-label">Days Tracked</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number">${Math.round((recent.length / 7) * 100)}%</div>
                    <div class="progress-label">Tracking Consistency</div>
                </div>
            `;
        }

        // Event handlers
        function selectDistortion(element) {
            element.classList.toggle('selected');
        }

        function toggleWarningSignal(element) {
            element.classList.toggle('identified');
        }

        function toggleActivity(element, category, index) {
            const checkbox = element.querySelector('.activity-checkbox');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('completed', checkbox.checked);
            
            if (checkbox.checked) {
                showToast(`Completed: ${behavioralActivities[category][index]}`);
            }
        }

        function addCustomActivity() {
            const activity = document.getElementById('customActivity').value.trim();
            const category = document.getElementById('customCategory').value;
            
            if (!activity) return;

            behavioralActivities[category].push(activity);
            generateBehavioralActivities();
            document.getElementById('customActivity').value = '';
            showToast('Custom activity added!');
        }

        function addSolution() {
            const solution = document.getElementById('newSolution').value.trim();
            if (!solution) return;

            const solutionsList = document.getElementById('solutionsList');
            const solutionElement = document.createElement('div');
            solutionElement.className = 'solution-item';
            solutionElement.textContent = solution;
            solutionElement.onclick = () => solutionElement.classList.toggle('selected');
            
            solutionsList.appendChild(solutionElement);
            document.getElementById('newSolution').value = '';
        }

        function shareWithProfessional() {
            // In a real app, this would share with actual healthcare provider
            logProfessionalAlert('Thought record shared by user', 'User requested professional review');
            showToast('Shared with your therapist for review!');
        }

        function activateCrisisProtocol() {
            logProfessionalAlert('Crisis protocol activated by user', 'User requested crisis intervention');
            showCrisisAlert();
            showToast('Crisis protocol activated. Professional help has been notified.');
        }

        function startBreathingExercise() {
            const circle = document.getElementById('breathingCircle');
            let phase = 'inhale';
            let count = 0;
            
            const breathingCycle = setInterval(() => {
                switch(phase) {
                    case 'inhale':
                        circle.style.transform = 'scale(1.5)';
                        circle.style.background = 'var(--primary-teal)';
                        circle.style.color = 'white';
                        circle.textContent = 'INHALE';
                        setTimeout(() => { phase = 'hold'; }, 4000);
                        break;
                    case 'hold':
                        circle.textContent = 'HOLD';
                        circle.style.background = 'var(--primary-amber)';
                        setTimeout(() => { phase = 'exhale'; }, 7000);
                        break;
                    case 'exhale':
                        circle.style.transform = 'scale(1)';
                        circle.style.background = 'var(--success-green)';
                        circle.textContent = 'EXHALE';
                        setTimeout(() => { 
                            phase = 'inhale';
                            count++;
                            if (count >= 4) {
                                clearInterval(breathingCycle);
                                circle.style.transform = 'scale(1)';
                                circle.style.background = 'transparent';
                                circle.style.color = 'var(--text-primary)';
                                circle.textContent = 'COMPLETE';
                                showToast('Breathing exercise completed!');
                            }
                        }, 8000);
                        break;
                }
            }, 100);
        }

        // Clear functions
        function clearThoughtRecord() {
            const inputs = ['situation', 'automaticThoughts', 'evidenceFor', 'evidenceAgainst', 'balancedThought'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            
            document.querySelectorAll('.mood-number').forEach(n => n.classList.remove('selected'));
            document.querySelectorAll('.distortion-item').forEach(d => d.classList.remove('selected'));
            document.getElementById('situationType').value = '';
        }

        function clearMoodForm() {
            document.querySelectorAll('.mood-number').forEach(n => n.classList.remove('selected'));
            const triggers = document.getElementById('moodTriggers');
            const positive = document.getElementById('positiveFactors');
            if (triggers) triggers.value = '';
            if (positive) positive.value = '';
        }

        // Data management
        function loadCBTData() {
            const saved = localStorage.getItem('enhancedCBTData');
            if (saved) {
                cbtData = { ...cbtData, ...JSON.parse(saved) };
            }
        }

        function saveCBTData() {
            cbtData.lastSaved = new Date().toISOString();
            localStorage.setItem('enhancedCBTData', JSON.stringify(cbtData));
        }

        function exportMoodData() {
            const exportData = {
                moodEntries: cbtData.moodEntries,
                thoughtRecords: cbtData.thoughtRecords,
                exportDate: new Date().toISOString(),
                totalEntries: cbtData.moodEntries.length
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'enhanced-cbt-data-export.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('CBT data exported successfully!');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success-green);
                color: white;
                padding: 1rem 2rem;
                border: 3px solid var(--neutral-dark);
                box-shadow: var(--shadow-brutal);
                z-index: 1001;
                font-weight: 600;
                max-width: 350px;
                font-family: 'Figtree', sans-serif;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        // Additional placeholder functions for professional features
        function shareWithSupportTeam() {
            logProfessionalAlert('Shared with support team', 'User shared relapse prevention plan');
            showToast('Shared with your support team!');
        }

        function scheduleFollowUp() {
            showToast('Follow-up scheduled with your therapist!');
        }

        function generateWeeklyPlan() {
            showToast('Personalized weekly plan generated based on your preferences!');
        }

        function generateMoodReport() {
            showToast('Weekly mood report generated and shared with your care team!');
        }

        function startGuidedMeditation() {
            showToast('Starting trauma-informed guided meditation session...');
        }

        function saveMindfulnessSession() {
            const session = {
                timestamp: new Date().toISOString(),
                bodyAwareness: document.getElementById('bodyAwareness')?.value || '',
                emotionalAwareness: document.getElementById('emotionalAwareness')?.value || '',
                thoughtAwareness: document.getElementById('thoughtAwareness')?.value || '',
                selfCompassion: document.getElementById('selfCompassion')?.value || ''
            };

            cbtData.mindfulnessSessions.push(session);
            saveCBTData();
            showToast('Mindfulness session saved!');
        }

        function saveProblemSolvingSession() {
            const session = {
                timestamp: new Date().toISOString(),
                problemDefinition: document.getElementById('problemDefinition')?.value || '',
                goal: document.getElementById('problemGoal')?.value || '',
                solutions: Array.from(document.querySelectorAll('.solution-item')).map(el => ({
                    text: el.textContent,
                    selected: el.classList.contains('selected')
                })),
                evaluation: document.getElementById('solutionEvaluation')?.value || '',
                implementationPlan: document.getElementById('implementationPlan')?.value || '',
                evaluationPlan: document.getElementById('evaluationPlan')?.value || ''
            };

            cbtData.problemSolvingSessions.push(session);
            saveCBTData();
            showToast('Problem-solving session saved!');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeCBTTools);
    </script>
</body>
</html>